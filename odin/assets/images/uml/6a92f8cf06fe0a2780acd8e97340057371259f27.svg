<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="130px" preserveAspectRatio="none" style="width:506px;height:130px;background:#000000;" version="1.1" viewBox="0 0 506 130" width="506px" zoomAndPan="magnify"><defs/><g><text fill="#33FF02" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="165" x="5" y="18.5352">[From string (line 34) ]</text><line style="stroke: #33FF02; stroke-width: 1.0;" x1="5" x2="504" y1="26.4883" y2="26.4883"/><text fill="#33FF02" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="164" x="5" y="45.0234">... (skipping 30 lines) ...</text><text fill="#33FF02" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="479" x="25" y="61.5117">odin -&gt; odin : [Perform machine-registration flow in background]</text><text fill="#33FF02" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="287" x="25" y="78">user &lt;- odin : Show sign-up successful</text><text fill="#33FF02" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="5" y="94.4883">else</text><text fill="#33FF02" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="392" x="25" y="110.9766">odin &lt;- userRegistry User registration request denied</text><text fill="#33FF02" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="0" x="10" y="127.4648"/><text fill="#FF0000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="94" x="10" y="127.4648">Syntax Error?</text><!--
@startuml


actor "User/Browser" as user
participant Odin as odin
participant "OpenID Provider" as openId
participant "Token endpoint" as getToken
participant "UserInfo endpoint" as userInfo
participant "User Registration Server" as userRegistry
database "User Identities" as usersDb

user -> odin : Selects new account registration
user <- odin : Generates OpenID Connect Authorize request and redirects to OpenID server
user -> openId : Authenticates
user <- openId : Redirects user back to Odin with one-time code
user -> odin : Request authorization with one-time code

odin <-> getToken : Exchange one-time code for access-token
odin <-> userInfo : Use access-token to obtain user-identifier
odin -> odin : Generate 'CA' user certificate with hash of user-identifier + random-key
odin -> userRegistry : Pass access-token, certificate, user-identifer and random-key

userRegistry <-> userInfo : Retrieve user-identifier belonging to session
userRegistry -> userRegistry : Verify user-identifier and certificate

alt authorisation request legitimate
    userRegistry -> userRegistry : Sign certificate
    userRegistry <-> usersDb : Store user-identifier, signed certificate and random-key
    odin <- userRegistry : Pass signed-certificate
    odin -> odin : store signed-certicate and register as login-entrypoint for user
    odin -> odin : [Perform machine-registration flow in background]
    user <- odin : Show sign-up successful
else
    odin <- userRegistry User registration request denied
    user <- odin User registration request denied
end

@enduml

PlantUML version 1.2018.14(Fri Dec 21 17:33:16 CET 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 9.0.4+11
Operating System: Mac OS X
OS Version: 10.14.5
Default Encoding: UTF-8
Language: en
Country: NL
--></g></svg>